<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POI Circuit Validation</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f5f7fa; margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 30px; }
        .header { border-bottom: 2px solid #e9ecef; padding-bottom: 20px; margin-bottom: 25px; }
        .poi-title { font-size: 16px; font-weight: 600; color: #333; margin-bottom: 15px; }
        .poi-description { color: #666; margin-bottom: 20px; font-size: 14px; }
        .drpep-link { color: #0066cc; text-decoration: underline; }
        .radio-options { margin: 20px 0; }
        .radio-option { display: flex; align-items: center; margin: 10px 0; padding: 8px 0; }
        .radio-option input[type="radio"] { margin-right: 12px; transform: scale(1.1); }
        .radio-option label { color: #333; cursor: pointer; font-size: 14px; }
        .poi-fields { margin-top: 25px; padding: 20px; background: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6; }
        .field-section { margin: 20px 0; }
        .field-section.hidden { display: none; }
        .field-instructions { color: #666; font-style: italic; margin-bottom: 15px; font-size: 13px; }
        .field-row { display: flex; gap: 20px; margin: 15px 0; align-items: center; }
        .field-group { flex: 1; min-width: 200px; }
        .field-group label { display: block; font-weight: 600; margin-bottom: 5px; color: #333; font-size: 14px; }
        .required { color: #dc3545; }
        .field-group input, .field-group select { width: 100%; padding: 10px; border: 2px solid #ced4da; border-radius: 4px; font-size: 14px; box-sizing: border-box; }
        .field-group input:focus, .field-group select:focus { border-color: #80bdff; outline: none; box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25); }
        .autocomplete-container { position: relative; }
        .autocomplete-suggestions { position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #ced4da; border-top: none; border-radius: 0 0 4px 4px; max-height: 200px; overflow-y: auto; z-index: 1000; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: none; }
        .suggestion-item { padding: 12px; cursor: pointer; border-bottom: 1px solid #f1f3f4; font-size: 14px; }
        .suggestion-item:hover { background-color: #f8f9fa; }
        .suggestion-item:last-child { border-bottom: none; }
        .validation-error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 15px; border-radius: 6px; margin: 20px 0; font-size: 14px; display: none; }
        .caiso-link { color: #0066cc; text-decoration: underline; }
        .voltage-table { background: white; border-radius: 6px; margin: 20px 0; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .voltage-table table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .voltage-table th { background: #8B4513; color: white; padding: 12px; text-align: center; font-weight: 600; }
        .voltage-table td { padding: 10px 12px; text-align: center; border-bottom: 1px solid #eee; }
        .sce-voltage { background: #f8f9fa; }
        .caiso-voltage { background: #fff3cd; }
        .voltage-info { background: #e3f2fd; border: 1px solid #90caf9; padding: 15px; border-radius: 6px; margin: 15px 0; }
        .voltage-info h4 { margin: 0 0 10px 0; color: #1565c0; }
        .generation-info { background: #e8f5e8; border: 1px solid #4caf50; padding: 15px; border-radius: 6px; margin: 15px 0; font-size: 14px; display: none; }
        .ea-comments { margin-top: 30px; }
        .ea-comments label { font-weight: 600; color: #333; margin-bottom: 10px; display: block; }
        .ea-comments textarea { width: 100%; height: 100px; padding: 12px; border: 2px solid #ced4da; border-radius: 4px; font-family: inherit; font-size: 14px; resize: vertical; box-sizing: border-box; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2 style="margin: 0; color: #333;">POI Circuit Validation</h2>
        <p style="margin: 10px 0 0 0; color: #666;">Validate Point of Interconnection and prevent CAISO circuit submissions</p>
    </div>

    <div class="voltage-info">
        <h4>📊 Maximum Aggregate Generation by Voltage Level</h4>
        <p style="margin: 5px 0; color: #333;">Reference table for capacity limits and jurisdiction determination</p>
    </div>

    <div class="voltage-table">
        <table>
            <thead>
                <tr><th colspan="2">SCE Line Voltage</th><th colspan="2">CAISO Line Voltage</th></tr>
                <tr><th>Voltage</th><th>Max Generation</th><th>Voltage</th><th>Max Generation (N-1)</th></tr>
            </thead>
            <tbody>
                <tr class="sce-voltage"><td><b>12 kV</b></td><td>10 MW</td><td rowspan="6" class="caiso-voltage"><b>220 kV</b></td><td rowspan="6" class="caiso-voltage">1150 MW</td></tr>
                <tr class="sce-voltage"><td><b>16 kV</b></td><td>13 MW</td></tr>
                <tr class="sce-voltage"><td><b>25 kV</b></td><td>19 MW</td></tr>
                <tr class="sce-voltage"><td><b>33 kV</b></td><td>27 MW</td></tr>
                <tr class="sce-voltage"><td><b>66 kV</b></td><td>110 MW</td></tr>
                <tr class="sce-voltage"><td><b>115 kV</b></td><td>200 MW</td></tr>
                <tr class="caiso-voltage"><td colspan="2"></td><td><b>500 kV</b></td><td>1150 MW</td></tr>
            </tbody>
        </table>
    </div>

    <div class="poi-title">Point of Interconnection (POI)</div>
    <div class="poi-description">Please select your desired POI based on SCE's <span class="drpep-link">Distribution Resources Plan External Portal (DRPEP)</span></div>
    
    <div class="radio-options">
        <div class="radio-option">
            <input type="radio" id="substation" name="poi_type" value="substation" onchange="handlePOISelection()">
            <label for="substation">Substation</label>
        </div>
        <div class="radio-option">
            <input type="radio" id="distribution_sub" name="poi_type" value="distribution_sub" onchange="handlePOISelection()">
            <label for="distribution_sub">Distribution Feeder or Sub Transmission Line</label>
        </div>
        <div class="radio-option">
            <input type="radio" id="approximate" name="poi_type" value="approximate" onchange="handlePOISelection()">
            <label for="approximate">Approximate location of the proposed Point of Interconnection</label>
        </div>
    </div>

    <div class="poi-fields">
        <div id="substation_fields" class="field-section hidden">
            <div class="field-instructions">Please select a Substation to proceed.<br><em>(If unable to find suitable option, choose 'Other' and enter manually).</em></div>
            <div class="field-row">
                <div class="field-group">
                    <label for="substation_name">Substation (Name and Voltage Level) <span class="required">*</span></label>
                    <input type="text" id="substation_name" name="substation_name" placeholder="Enter substation name...">
                </div>
            </div>
        </div>

        <div id="distribution_sub_fields" class="field-section hidden">
            <div class="field-instructions">Please select a Subtransmission Line or Distribution Feeder to proceed.<br><em>(If unable to find suitable option, choose 'Other' and enter manually).</em></div>
            <div class="field-row">
                <div class="field-group">
                    <label for="subtransmission_line">Subtransmission Line <span class="required">*</span></label>
                    <div class="autocomplete-container">
                        <input type="text" id="subtransmission_line" name="subtransmission_line" placeholder="Start typing to search..." oninput="handleSubSearch(this.value)" onblur="hideSuggestions('sub')">
                        <div id="sub_suggestions" class="autocomplete-suggestions"></div>
                    </div>
                </div>
            </div>
            <div class="field-row">
                <div class="field-group">
                    <label for="distribution_feeder">Distribution Feeder (Circuit / Line) <span class="required">*</span></label>
                    <div class="autocomplete-container">
                        <input type="text" id="distribution_feeder" name="distribution_feeder" placeholder="Start typing to search..." oninput="handleFeederSearch(this.value)" onblur="hideSuggestions('feeder')">
                        <div id="feeder_suggestions" class="autocomplete-suggestions"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="common_fields" class="field-section hidden">
            <div class="field-row">
                <div class="field-group">
                    <label for="system">System</label>
                    <input type="text" id="system" name="system" placeholder="Enter system...">
                </div>
            </div>
            <div class="field-row">
                <div class="field-group">
                    <label for="poi_voltage">POI Voltage (kV) <span class="required">*</span></label>
                    <select id="poi_voltage" name="poi_voltage" onchange="validateVoltage()">
                        <option value="">Please Select</option>
                        <option value="12">12 kV</option>
                        <option value="16">16 kV</option>
                        <option value="25">25 kV</option>
                        <option value="33">33 kV</option>
                        <option value="66">66 kV</option>
                        <option value="115">115 kV</option>
                        <option value="220">220 kV (CAISO)</option>
                        <option value="500">500 kV (CAISO)</option>
                    </select>
                </div>
                <div class="field-group">
                    <label for="substation_bus">Substation Bus <span class="required">*</span></label>
                    <select id="substation_bus" name="substation_bus">
                        <option value="115kv">115 kV Bus</option>
                        <option value="12kv">12 kV Bus</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>
            <div id="generation_info" class="generation-info">
                <strong>💡 Maximum Generation Capacity:</strong>
                <div id="capacity_details"></div>
            </div>
        </div>
    </div>

    <div id="caiso_warning" class="validation-error">
        <strong>⚠️ CAISO Controlled Circuit Detected</strong><br>
        The POI is served by CAISO controlled infrastructure. Visit <a href="#" class="caiso-link">California ISO</a> to submit Pre-Application Report request.
    </div>

    <div id="voltage_warning" class="validation-error">
        <strong>⚠️ CAISO Transmission Level Voltage</strong><br>
        This is CAISO transmission voltage. Visit <a href="https://www.caiso.com" class="caiso-link">https://www.caiso.com</a> for Pre-Application Request.
    </div>

    <div class="ea-comments">
        <label for="ea_comments">EA Comments:</label>
        <textarea id="ea_comments" name="ea_comments" placeholder="Enter additional comments..."></textarea>
    </div>
</div>

<script>
const voltageCapacity = {
    12: { capacity: '10 MW', type: 'SCE', kw: '10,000 kW' },
    16: { capacity: '13 MW', type: 'SCE', kw: '13,000 kW' },
    25: { capacity: '19 MW', type: 'SCE', kw: '19,000 kW' },
    33: { capacity: '27 MW', type: 'SCE', kw: '27,000 kW' },
    66: { capacity: '110 MW', type: 'SCE', kw: '110,000 kW' },
    115: { capacity: '200 MW', type: 'SCE', kw: '200,000 kW' },
    220: { capacity: '1150 MW (N-1)', type: 'CAISO', kw: '1,150,000 kW' },
    500: { capacity: '1150 MW (N-1)', type: 'CAISO', kw: '1,150,000 kW' }
};

const caisoSubstations = ["Control", "Zack", "Deep Springs", "Fish Lake Valley", "Antelope", "Bailey", "Neenach", "Coso", "Haiwee", "Inyokern", "Randsburg", "Kramer", "Roadway", "Victor", "Tortilla", "Coolwater", "Dunn Siding", "Baker", "Mountain Pass", "Ivanpah"];

const caisoLines = ["Control-Silver Peak \"A\"", "Control-Silver Peak \"C\"", "Antelope-Neenach", "Bailey-Neenach-Westpac", "Control-Haiwee-Inyokern", "Control-Coso-Haiwee-Inyokern", "Kramer-Inyokern-Randsburg No.1", "Kramer-Inyokern-Randsburg No.3", "Kramer-Victor", "Kramer-Roadway", "Kramer-Coolwater", "Kramer-Tortilla", "Coolwater-SEGS2-Tortilla", "Victor-Roadway", "Coolwater-Ivanpah-Baker-Dunn Siding-Mountain Pass"];

const subLines = ["Control-Silver Peak \"A\" 55 kV Line", "Control-Silver Peak \"C\" 55 kV Line", "Antelope-Neenach 66 kV Line", "Bailey-Neenach-Westpac 66 kV Line", "Control-Haiwee-Inyokern 115 kV Line", "Control-Coso-Haiwee-Inyokern 115 kV Line", "Kramer-Inyokern-Randsburg No.1 115 kV Line", "Kramer-Inyokern-Randsburg No.3 115 kV Line", "Kramer-Victor 115 kV Line", "Kramer-Roadway 115 kV Line", "Kramer-Coolwater 115 kV Line", "Kramer-Tortilla 115 kV Line", "Coolwater-SEGS2-Tortilla 115 kV Line", "Victor-Roadway 115 kV Line", "Coolwater-Ivanpah-Baker-Dunn Siding-Mountain Pass 115 kV Line"];

const feeders = ["Antelope Circuit 1", "Antelope Circuit 2", "Bailey Circuit 1", "Bailey Circuit 2", "Control Circuit 1", "Control Circuit 2", "Coso Circuit 1", "Haiwee Circuit 1", "Inyokern Circuit 1", "Kramer Circuit 1", "Victor Circuit 1", "Tortilla Circuit 1"];

function handlePOISelection() {
    const selected = document.querySelector('input[name="poi_type"]:checked')?.value;
    
    document.getElementById('substation_fields').classList.add('hidden');
    document.getElementById('distribution_sub_fields').classList.add('hidden');
    document.getElementById('common_fields').classList.add('hidden');
    document.getElementById('caiso_warning').style.display = 'none';
    document.getElementById('voltage_warning').style.display = 'none';
    
    if (selected === 'substation') {
        document.getElementById('substation_fields').classList.remove('hidden');
        document.getElementById('common_fields').classList.remove('hidden');
    } else if (selected === 'distribution_sub') {
        document.getElementById('distribution_sub_fields').classList.remove('hidden');
        document.getElementById('common_fields').classList.remove('hidden');
    }
}

function handleSubSearch(value) {
    showSuggestions('sub', value, subLines, selectSubLine);
    checkCaisoLine(value);
}

function handleFeederSearch(value) {
    showSuggestions('feeder', value, feeders, selectFeeder);
}

function showSuggestions(type, value, data, selectFn) {
    const div = document.getElementById(type + '_suggestions');
    if (value.length < 2) { div.style.display = 'none'; return; }
    
    const filtered = data.filter(item => item.toLowerCase().includes(value.toLowerCase()));
    if (filtered.length === 0) { div.style.display = 'none'; return; }
    
    div.innerHTML = filtered.map(item => `<div class="suggestion-item" onclick="${selectFn.name}('${item}')">${item}</div>`).join('');
    div.style.display = 'block';
}

function selectSubLine(line) {
    document.getElementById('subtransmission_line').value = line;
    hideSuggestions('sub');
    checkCaisoLine(line);
}

function selectFeeder(feeder) {
    document.getElementById('distribution_feeder').value = feeder;
    hideSuggestions('feeder');
}

function hideSuggestions(type) {
    setTimeout(() => document.getElementById(type + '_suggestions').style.display = 'none', 200);
}

function checkCaisoLine(value) {
    const isCaiso = caisoLines.some(line => value.toLowerCase().includes(line.toLowerCase()));
    document.getElementById('caiso_warning').style.display = isCaiso ? 'block' : 'none';
}

function validateVoltage() {
    const voltage = parseFloat(document.getElementById('poi_voltage').value);
    const info = voltageCapacity[voltage];
    
    if (info) {
        document.getElementById('generation_info').style.display = 'block';
        document.getElementById('capacity_details').innerHTML = `<div style="margin-top: 10px;"><strong>Max Generation:</strong> ${info.capacity}<br><strong>Conversion:</strong> ${info.kw}<br><strong>Jurisdiction:</strong> ${info.type}</div>`;
        document.getElementById('voltage_warning').style.display = info.type === 'CAISO' ? 'block' : 'none';
    } else {
        document.getElementById('generation_info').style.display = 'none';
        document.getElementById('voltage_warning').style.display = 'none';
    }
}

document.addEventListener('DOMContentLoaded', function() {
    const substationInput = document.getElementById('substation_name');
    if (substationInput) {
        substationInput.addEventListener('input', function(e) {
            const isCaiso = caisoSubstations.some(sub => e.target.value.toLowerCase().includes(sub.toLowerCase()));
            document.getElementById('caiso_warning').style.display = isCaiso ? 'block' : 'none';
        });
    }
});
</script>

</body>
</html>
